@page "/view-organisation/{Id}"
@using OpenReferralPOV.Data
@using OpenReferralPOV.Services

@inject IOpenReferralService ServiceService
@inject IOpenReferralOrganisationService OrgService

<div class="content-container">
    <div class="gridder">

        @if (loading)
        {
            <p><em>Loading...</em></p>
        }

        else
        {
            <div class="two-cols">
                <div class="col col-left">
                    <h2 for="Name">@organisation.Name</h2>

                    <h4 for="Description">@organisation.Description</h4>

                    <h4 for="Charity Number">Charity Number: @organisation.CharityNumber</h4>

                    <h4 for="Url">Website:<a href="@organisation.Url"> @organisation.Url</a></h4>
                    @if (@httpError != null)
                    {
                        <warn>There was an error.</warn>
                        <br />
                        <warn>@httpError.StatusCode - @httpError.Message</warn>
                    }
                </div>
                <div class="col col-right">

                    <h3>Services</h3>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Service Name</th>
                                <th>Service URL</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var service in services)
                            {
                                <tr>
                                    <td><NavLink href=@($"view-service/{service.Id}")>@service.Name</NavLink></td>
                                    <td>@service.Url</td>
                                </tr>

                            }
                        </tbody>
                    </table>
                </div>
            </div>
        }
    </div>
</div>
@code {

    [CascadingParameter]
    Error Error { get; set; }
    HttpRequestException httpError { get; set; }
    [Parameter]
    public string Id { get; set; }

    public bool loading { get; set; } = true;

    public Organization organisation { get; set; }
    public IEnumerable<Service> services { get; set; } = new List<Service>();
    public PhysicalAddress address;
    public PhysicalAddress originalAddress;
    public Organization serviceOrg;


    protected override async Task OnInitializedAsync()
    {
        organisation = await OrgService.GetOrganisation(Id);

        services = (await ServiceService.GetServicesAsync()).Where(x => x.OrganizationId == Id);

        //Doing this to check if the postcode has changed.
        loading = false;
    }
}
